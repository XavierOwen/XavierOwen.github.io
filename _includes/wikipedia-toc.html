{% if page.toc %}
<div class="wiki-toc" id="wiki-toc">
  <div class="wiki-toc-header">
    <span>Contents</span>
    <button class="wiki-toc-toggle" onclick="toggleToc()" aria-label="Toggle table of contents">
      [<span class="wiki-toc-toggle-text">hide</span>]
    </button>
  </div>
  <div class="wiki-toc-content" style="display: block;">
    {% include toc.html html=content sanitize=true h_min=2 %}
  </div>
</div>

<button class="wiki-toc-float-toggle" id="wiki-toc-float-toggle" onclick="toggleFloatingToc()" aria-label="Show table of contents">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
    <path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"/>
  </svg>
</button>

<script>
function toggleToc() {
  const toc = document.querySelector('.wiki-toc-content');
  const toggleText = document.querySelector('.wiki-toc-toggle-text');
  if (toc.style.display === 'none') {
    toc.style.display = 'block';
    toggleText.textContent = 'hide';
    localStorage.setItem('wiki-toc-state', 'shown');
  } else {
    toc.style.display = 'none';
    toggleText.textContent = 'show';
    localStorage.setItem('wiki-toc-state', 'hidden');
  }

  // Don't persist state on mobile
  if (window.innerWidth < 1024) {
    localStorage.removeItem('wiki-toc-state');
  }
}

function toggleFloatingToc() {
  const toc = document.getElementById('wiki-toc');
  if (toc.classList.contains('wiki-toc-float-show')) {
    toc.classList.remove('wiki-toc-float-show');
  } else {
    toc.classList.add('wiki-toc-float-show');
  }
}

// Close floating TOC when clicking outside
document.addEventListener('click', function(event) {
  const toc = document.getElementById('wiki-toc');
  const floatButton = document.getElementById('wiki-toc-float-toggle');
  if (!toc.contains(event.target) && event.target !== floatButton) {
    toc.classList.remove('wiki-toc-float-show');
  }
});

// Restore TOC state on page load for large screens
document.addEventListener('DOMContentLoaded', function() {
  if (window.innerWidth >= 1024) { // $large breakpoint
    const savedState = localStorage.getItem('wiki-toc-state');
    if (savedState === 'hidden') {
      const toc = document.querySelector('.wiki-toc-content');
      const toggleText = document.querySelector('.wiki-toc-toggle-text');
      toc.style.display = 'none';
      toggleText.textContent = 'show';
    }
  }
});
</script>
{% endif %}
